<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-User Productivity Planner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Nikosh', sans-serif; }
        body { background: var(--bg-gradient, linear-gradient(135deg, #667eea 0%, #764ba2 100%)); min-height: 100vh; padding: 20px; transition: background 0.3s; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: var(--header-gradient, linear-gradient(135deg, #2c3e50 0%, #3498db 100%)); color: white; padding: 30px; text-align: center; position: relative; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .user-info { position: absolute; top: 20px; right: 20px; display: flex; align-items: center; gap: 10px; }
        .user-name { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .tabs { display: flex; background: #34495e; padding: 0; flex-wrap: wrap; }
        .tab { padding: 15px 30px; color: white; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab.active { background: var(--primary-color, #3498db); border-bottom: 3px solid var(--accent-color, #e74c3c); }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .auth-container { max-width: 400px; margin: 50px auto; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .auth-container h2 { text-align: center; margin-bottom: 30px; color: #2c3e50; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; transition: border 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary-color, #3498db); outline: none; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1em; cursor: pointer; transition: all 0.3s; font-weight: bold; margin: 5px; }
        .btn-primary { background: var(--primary-color, #3498db); color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .time-slot { display: grid; grid-template-columns: 120px 1fr 100px 120px auto; gap: 15px; align-items: center; padding: 15px; margin-bottom: 10px; border-radius: 10px; transition: all 0.3s; border-left: 5px solid var(--primary-color, #3498db); background: #f8f9fa; }
        .time-slot:hover { transform: translateX(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .time { font-weight: bold; color: #2c3e50; }
        .activity { font-size: 1.1em; }
        .duration { background: var(--primary-color, #3498db); color: white; padding: 5px 10px; border-radius: 20px; text-align: center; }
        .category { padding: 5px 15px; border-radius: 20px; font-size: 0.8em; font-weight: bold; text-align: center; }
        .spiritual { background: #e8f6f3; color: #1abc9c; border-left-color: #1abc9c; }
        .deep-work { background: #ebf5fb; color: #2980b9; border-left-color: #2980b9; }
        .learning { background: #fef9e7; color: #f39c12; border-left-color: #f39c12; }
        .office { background: #f4ecf7; color: #8e44ad; border-left-color: #8e44ad; }
        .family { background: #f9ebea; color: #c0392b; border-left-color: #c0392b; }
        .self-care { background: #eafaf1; color: #27ae60; border-left-color: #27ae60; }
        .sleep { background: #ebedef; color: #7f8c8d; border-left-color: #7f8c8d; }
        .break { background: #fcf3cf; color: #f1c40f; border-left-color: #f1c40f; }
        .action-buttons { display: flex; gap: 5px; }
        .action-btn { padding: 6px 12px; border: none; border-radius: 15px; cursor: pointer; font-size: 0.8em; transition: all 0.3s; }
        .edit-btn { background: #3498db; color: white; }
        .delete-btn { background: #e74c3c; color: white; }
        .save-btn { background: #27ae60; color: white; }
        .cancel-btn { background: #95a5a6; color: white; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; background: #f8f9fa; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; color: var(--primary-color, #3498db); }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto; }
        .settings-card { background: #f8f9fa; padding: 20px; border-radius: 10px; }
        .settings-card h3 { margin-bottom: 15px; color: #2c3e50; }
        .color-picker-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .color-preview { width: 40px; height: 40px; border-radius: 8px; border: 2px solid #ddd; }
        .theme-preset { padding: 15px; border-radius: 10px; cursor: pointer; margin-bottom: 10px; transition: all 0.3s; border: 2px solid transparent; }
        .theme-preset:hover { border-color: var(--primary-color, #3498db); transform: scale(1.02); }
        .auth-toggle { text-align: center; margin-top: 20px; }
        .auth-toggle a { color: var(--primary-color, #3498db); cursor: pointer; text-decoration: underline; }
        @media (max-width: 768px) {
            .time-slot { grid-template-columns: 1fr; gap: 10px; }
            .tabs { flex-direction: column; }
            .user-info { position: static; justify-content: center; margin-top: 15px; }
        }
    </style>
</head>
<body>
    <div id="authScreen">
        <div class="auth-container">
            <h2 id="authTitle">Login</h2>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="authUsername" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="authPassword" placeholder="Enter password">
            </div>
            <div class="form-group" id="confirmPasswordGroup" style="display: none;">
                <label>Confirm Password:</label>
                <input type="password" id="authConfirmPassword" placeholder="Confirm password">
            </div>
            <div style="text-align: center;">
                <button class="btn btn-primary" id="authSubmitBtn" onclick="handleAuth()">Login</button>
            </div>
            <div class="auth-toggle">
                <span id="authToggleText">Don't have an account?</span>
                <a id="authToggleLink" onclick="toggleAuthMode()">Sign Up</a>
            </div>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="user-name" id="currentUserDisplay"></div>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
                <h1 id="headerTitle">‚úèÔ∏è Productivity Planner</h1>
                <p id="headerSubtitle">Customize Your Way</p>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('view')" id="tabView">üìã View</div>
                <div class="tab" onclick="switchTab('add')" id="tabAdd">‚ûï Add</div>
                <div class="tab" onclick="switchTab('manage')" id="tabManage">‚öôÔ∏è Manage</div>
                <div class="tab" onclick="switchTab('settings')" id="tabSettings">üé® Settings</div>
            </div>

            <div id="view" class="tab-content active">
                <div class="stats" id="stats"></div>
                <div id="schedule"></div>
                <div style="text-align: center; padding: 20px;">
                    <button class="btn btn-primary" onclick="exportToCSV()">üì• CSV</button>
                    <button class="btn btn-success" onclick="window.print()">üñ®Ô∏è Print</button>
                </div>
            </div>

            <div id="add" class="tab-content">
                <div style="max-width: 600px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Add New Task</h2>
                    <div class="form-group">
                        <label>Time:</label>
                        <input type="text" id="newTime" placeholder="e.g., 4:50 AM">
                    </div>
                    <div class="form-group">
                        <label>Activity:</label>
                        <textarea id="newActivity" placeholder="Enter activity" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Duration:</label>
                        <input type="text" id="newDuration" placeholder="e.g., 20m">
                    </div>
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="newCategory">
                            <option value="spiritual">Spiritual</option>
                            <option value="deep-work">Deep Work</option>
                            <option value="learning">Learning</option>
                            <option value="office">Office</option>
                            <option value="family">Family</option>
                            <option value="self-care">Self Care</option>
                            <option value="sleep">Sleep</option>
                            <option value="break">Break</option>
                        </select>
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-success" onclick="addNewActivity()">üíæ Save</button>
                        <button class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Clear</button>
                    </div>
                </div>
            </div>

            <div id="manage" class="tab-content">
                <div style="text-align: center; margin-bottom: 20px;">
                    <button class="btn btn-warning" onclick="resetToDefault()">üîÑ Reset</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Delete All</button>
                </div>
                <div id="editSchedule"></div>
            </div>

            <div id="settings" class="tab-content">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>üé® Theme Presets</h3>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="applyTheme('purple')">
                            <strong>Purple Dream</strong>
                        </div>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="applyTheme('pink')">
                            <strong>Pink Sunset</strong>
                        </div>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" onclick="applyTheme('blue')">
                            <strong>Ocean Blue</strong>
                        </div>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" onclick="applyTheme('green')">
                            <strong>Fresh Green</strong>
                        </div>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="applyTheme('warm')">
                            <strong>Warm Glow</strong>
                        </div>
                        <div class="theme-preset" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);" onclick="applyTheme('dark')">
                            <strong>Dark Mode</strong>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>üåç Language</h3>
                        <select id="languageSelect" onchange="changeLanguage(this.value)" style="margin-bottom: 20px;">
                            <option value="en">English</option>
                            <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                        </select>

                        <h3>üé® Custom Colors</h3>
                        <div class="color-picker-group">
                            <label>Primary:</label>
                            <input type="color" id="primaryColor" value="#3498db" onchange="applyCustomColors()">
                            <div class="color-preview" id="primaryPreview" style="background: #3498db;"></div>
                        </div>
                        <div class="color-picker-group">
                            <label>Accent:</label>
                            <input type="color" id="accentColor" value="#e74c3c" onchange="applyCustomColors()">
                            <div class="color-preview" id="accentPreview" style="background: #e74c3c;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let isLoginMode = true;
        const defaultSchedule = [
            { id: 1, time: "4:50 AM", activity: "Morning Prayer + Meditation", duration: "20m", category: "spiritual" },
            { id: 2, time: "5:10 AM", activity: "Deep Work Session", duration: "1h 15m", category: "deep-work" },
            { id: 3, time: "6:25 AM", activity: "Learning Time", duration: "15m", category: "learning" },
            { id: 4, time: "6:40 AM", activity: "Breakfast + Commute", duration: "1h 20m", category: "self-care" },
            { id: 5, time: "9:00 AM", activity: "Office Work - Session 1", duration: "2h 15m", category: "office" },
            { id: 6, time: "11:15 AM", activity: "Break", duration: "15m", category: "break" },
            { id: 7, time: "1:15 PM", activity: "Midday Prayer", duration: "15m", category: "spiritual" },
            { id: 8, time: "1:30 PM", activity: "Office Work - Session 2", duration: "2h 45m", category: "office" },
            { id: 9, time: "4:15 PM", activity: "Afternoon Prayer", duration: "15m", category: "spiritual" },
            { id: 10, time: "4:30 PM", activity: "Office Work - Final", duration: "1h", category: "office" },
            { id: 11, time: "5:30 PM", activity: "Commute + Learning", duration: "1h", category: "learning" },
            { id: 12, time: "6:30 PM", activity: "Evening Prayer", duration: "15m", category: "spiritual" },
            { id: 13, time: "7:00 PM", activity: "Family Dinner", duration: "45m", category: "family" },
            { id: 14, time: "7:45 PM", activity: "Night Prayer", duration: "15m", category: "spiritual" },
            { id: 15, time: "8:00 PM", activity: "Family Time", duration: "30m", category: "family" },
            { id: 16, time: "8:30 PM", activity: "Personal Projects", duration: "1h", category: "deep-work" },
            { id: 17, time: "9:30 PM", activity: "Learning Practice", duration: "30m", category: "learning" },
            { id: 18, time: "10:00 PM", activity: "Wind Down", duration: "30m", category: "self-care" },
            { id: 19, time: "10:30 PM", activity: "Reading", duration: "30m", category: "self-care" },
            { id: 20, time: "11:00 PM", activity: "Sleep", duration: "6h 30m", category: "sleep" }
        ];
        let scheduleData = [];
        let editMode = {};
        const translations = {
            bn: { title: "‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡¶ø‡¶ü‡¶ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞", subtitle: "‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®", viewTab: "üìã ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®", addTab: "‚ûï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®", manageTab: "‚öôÔ∏è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú", settingsTab: "üé® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏", logout: "‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü", spiritual: "‡¶Ü‡¶ß‡ßç‡¶Ø‡¶æ‡¶§‡ßç‡¶Æ‡¶ø‡¶ï", deepWork: "‡¶°‡¶ø‡¶™ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï", learning: "‡¶∂‡ßá‡¶ñ‡¶æ", office: "‡¶Ö‡¶´‡¶ø‡¶∏", family: "‡¶™‡¶∞‡¶ø‡¶¨‡¶æ‡¶∞", selfCare: "‡¶∏‡ßá‡¶≤‡¶´-‡¶ï‡ßá‡¶Ø‡¶º‡¶æ‡¶∞", sleep: "‡¶ò‡ßÅ‡¶Æ", break: "‡¶¨‡¶ø‡¶∞‡¶§‡¶ø", totalTasks: "‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶ú", prayer: "‡¶∏‡¶æ‡¶≤‡¶æ‡¶§" },
            en: { title: "Productivity Planner", subtitle: "Customize Your Way", viewTab: "üìã View", addTab: "‚ûï Add", manageTab: "‚öôÔ∏è Manage", settingsTab: "üé® Settings", logout: "Logout", spiritual: "Spiritual", deepWork: "Deep Work", learning: "Learning", office: "Office", family: "Family", selfCare: "Self Care", sleep: "Sleep", break: "Break", totalTasks: "Total Tasks", prayer: "Prayer" },
            ar: { title: "ŸÖÿÆÿ∑ÿ∑ ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨Ÿäÿ©", subtitle: "ÿÆÿµÿµ ÿ®ÿ∑ÿ±ŸäŸÇÿ™ŸÉ", viewTab: "üìã ÿπÿ±ÿ∂", addTab: "‚ûï ÿ•ÿ∂ÿßŸÅÿ©", manageTab: "‚öôÔ∏è ÿ•ÿØÿßÿ±ÿ©", settingsTab: "üé® ÿ•ÿπÿØÿßÿØÿßÿ™", logout: "ÿÆÿ±Ÿàÿ¨", spiritual: "ÿ±Ÿàÿ≠ÿßŸÜŸä", deepWork: "ÿπŸÖŸÑ ÿπŸÖŸäŸÇ", learning: "ÿ™ÿπŸÑŸÖ", office: "ŸÖŸÉÿ™ÿ®", family: "ÿπÿßÿ¶ŸÑÿ©", selfCare: "ÿßŸÑÿπŸÜÿßŸäÿ©", sleep: "ŸÜŸàŸÖ", break: "ÿßÿ≥ÿ™ÿ±ÿßÿ≠ÿ©", totalTasks: "ÿßŸÑŸÖŸáÿßŸÖ", prayer: "ÿµŸÑÿßÿ©" }
        };
        let currentLang = 'en';

        function init() { checkAuth(); }
        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            savedUser ? (currentUser = savedUser, loadUserData(), showMainApp()) : showAuthScreen();
        }
        function showAuthScreen() {
            document.getElementById('authScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }
        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUserDisplay').textContent = currentUser;
            renderView(); renderStats(); applyUserPreferences();
        }
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').textContent = isLoginMode ? 'Login' : 'Sign Up';
            document.getElementById('authSubmitBtn').textContent = isLoginMode ? 'Login' : 'Create Account';
            document.getElementById('confirmPasswordGroup').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('authToggleText').textContent = isLoginMode ? "Don't have an account?" : "Already have an account?";
            document.getElementById('authToggleLink').textContent = isLoginMode ? 'Sign Up' : 'Login';
        }
        function handleAuth() {
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            if (!username || !password) { alert('Please enter both username and password!'); return; }
            if (isLoginMode) {
                const savedPassword = localStorage.getItem(`user_${username}_password`);
                savedPassword === password ? (currentUser = username, localStorage.setItem('currentUser', username), loadUserData(), showMainApp()) : alert('Invalid username or password!');
            } else {
                if (password !== confirmPassword) { alert('Passwords do not match!'); return; }
                if (password.length < 4) { alert('Password must be at least 4 characters!'); return; }
                if (localStorage.getItem(`user_${username}_password`)) { alert('Username already exists!'); return; }
                localStorage.setItem(`user_${username}_password`, password);
                localStorage.setItem(`user_${username}_schedule`, JSON.stringify(defaultSchedule));
                localStorage.setItem(`user_${username}_preferences`, JSON.stringify({ language: 'en', theme: 'purple', primaryColor: '#3498db', accentColor: '#e74c3c' }));
                currentUser = username;
                localStorage.setItem('currentUser', username);
                loadUserData(); showMainApp(); alert('Account created successfully!');
            }
        }
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                currentUser = null; scheduleData = [];
                document.getElementById('authUsername').value = '';
                document.getElementById('authPassword').value = '';
                document.getElementById('authConfirmPassword').value = '';
                showAuthScreen();
            }
        }
        function loadUserData() {
            const savedSchedule = localStorage.getItem(`user_${currentUser}_schedule`);
            savedSchedule ? scheduleData = JSON.parse(savedSchedule) : (scheduleData = [...defaultSchedule], saveUserData());
        }
        function saveUserData() { localStorage.setItem(`user_${currentUser}_schedule`, JSON.stringify(scheduleData)); }
        function applyUserPreferences() {
            const savedPrefs = localStorage.getItem(`user_${currentUser}_preferences`);
            if (savedPrefs) {
                const prefs = JSON.parse(savedPrefs);
                currentLang = prefs.language || 'en';
                document.getElementById('languageSelect').value = currentLang;
                if (prefs.theme) applyTheme(prefs.theme);
                if (prefs.primaryColor) {
                    document.getElementById('primaryColor').value = prefs.primaryColor;
                    document.getElementById('accentColor').value = prefs.accentColor;
                    applyCustomColors();
                }
                updateLanguage();
            }
        }
        function saveUserPreferences(prefs) {
            const savedPrefs = localStorage.getItem(`user_${currentUser}_preferences`);
            const currentPrefs = savedPrefs ? JSON.parse(savedPrefs) : {};
            localStorage.setItem(`user_${currentUser}_preferences`, JSON.stringify({ ...currentPrefs, ...prefs }));
        }
        function changeLanguage(lang) { currentLang = lang; saveUserPreferences({ language: lang }); updateLanguage(); }
        function updateLanguage() {
            const t = translations[currentLang];
            document.getElementById('headerTitle').innerHTML = `‚úèÔ∏è ${t.title}`;
            document.getElementById('headerSubtitle').textContent = t.subtitle;
            document.getElementById('tabView').innerHTML = t.viewTab;
            document.getElementById('tabAdd').innerHTML = t.addTab;
            document.getElementById('tabManage').innerHTML = t.manageTab;
            document.getElementById('tabSettings').innerHTML = t.settingsTab;
            const categorySelect = document.getElementById('newCategory');
            categorySelect.innerHTML = `
                <option value="spiritual">${t.spiritual}</option>
                <option value="deep-work">${t.deepWork}</option>
                <option value="learning">${t.learning}</option>
                <option value="office">${t.office}</option>
                <option value="family">${t.family}</option>
                <option value="self-care">${t.selfCare}</option>
                <option value="sleep">${t.sleep}</option>
                <option value="break">${t.break}</option>
            `;
            renderView(); renderStats();
        }
        function applyTheme(themeName) {
            const themes = {
                purple: { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', header: 'linear-gradient(135deg, #2c3e50 0%, #3498db 100%)' },
                pink: { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', header: 'linear-gradient(135deg, #d31027 0%, #ea384d 100%)' },
                blue: { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', header: 'linear-gradient(135deg, #0575e6 0%, #021b79 100%)' },
                green: { bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', header: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' },
                warm: { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', header: 'linear-gradient(135deg, #f83600 0%, #f9d423 100%)' },
                dark: { bg: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', header: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)' }
            };
            const theme = themes[themeName];
            document.body.style.setProperty('--bg-gradient', theme.bg);
            document.querySelector('.header').style.setProperty('--header-gradient', theme.header);
            saveUserPreferences({ theme: themeName });
        }
        function applyCustomColors() {
            const primary = document.getElementById('primaryColor').value;
            const accent = document.getElementById('accentColor').value;
            document.body.style.setProperty('--primary-color', primary);
            document.body.style.setProperty('--accent-color', accent);
            document.getElementById('primaryPreview').style.background = primary;
            document.getElementById('accentPreview').style.background = accent;
            saveUserPreferences({ primaryColor: primary, accentColor: accent });
        }
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            if (tabName === 'view') { renderView(); renderStats(); }
            else if (tabName === 'manage') renderEditableSchedule();
        }
        function renderView() {
            const el = document.getElementById('schedule');
            el.innerHTML = '';
            [...scheduleData].sort((a, b) => convertTimeToMinutes(a.time) - convertTimeToMinutes(b.time)).forEach(item => {
                const div = document.createElement('div');
                div.className = `time-slot ${item.category}`;
                div.innerHTML = `
                    <div class="time">${item.time}</div>
                    <div class="activity">${item.activity}</div>
                    <div class="duration">${item.duration}</div>
                    <div class="category ${item.category}">${getCategoryText(item.category)}</div>
                `;
                el.appendChild(div);
            });
        }
        function renderEditableSchedule() {
            const el = document.getElementById('editSchedule');
            el.innerHTML = '';
            [...scheduleData].sort((a, b) => convertTimeToMinutes(a.time) - convertTimeToMinutes(b.time)).forEach(item => {
                const isEditing = editMode[item.id];
                const div = document.createElement('div');
                div.className = `time-slot ${item.category}`;
                if (isEditing) {
                    div.innerHTML = `
                        <input type="text" class="time" value="${item.time}" id="edit-time-${item.id}">
                        <textarea class="activity" id="edit-activity-${item.id}" rows="2">${item.activity}</textarea>
                        <input type="text" class="duration" value="${item.duration}" id="edit-duration-${item.id}">
                        <select class="category" id="edit-category-${item.id}">${getCategoryOptions(item.category)}</select>
                        <div class="action-buttons">
                            <button class="action-btn save-btn" onclick="saveActivity(${item.id})">üíæ</button>
                            <button class="action-btn cancel-btn" onclick="cancelEdit(${item.id})">‚ùå</button>
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <div class="time">${item.time}</div>
                        <div class="activity">${item.activity}</div>
                        <div class="duration">${item.duration}</div>
                        <div class="category ${item.category}">${getCategoryText(item.category)}</div>
                        <div class="action-buttons">
                            <button class="action-btn edit-btn" onclick="startEdit(${item.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteActivity(${item.id})">üóëÔ∏è</button>
                        </div>
                    `;
                }
                el.appendChild(div);
            });
        }
        function renderStats() {
            const el = document.getElementById('stats');
            const categories = {};
            scheduleData.forEach(item => categories[item.category] = (categories[item.category] || 0) + 1);
            const t = translations[currentLang];
            el.innerHTML = `
                <div class="stat-card"><div class="stat-number">${scheduleData.length}</div><div>${t.totalTasks}</div></div>
                <div class="stat-card"><div class="stat-number">${categories['spiritual'] || 0}</div><div>${t.prayer}</div></div>
                <div class="stat-card"><div class="stat-number">${categories['deep-work'] || 0}</div><div>${t.deepWork}</div></div>
                <div class="stat-card"><div class="stat-number">${categories['family'] || 0}</div><div>${t.family}</div></div>
            `;
        }
        function getCategoryText(category) {
            const t = translations[currentLang];
            const map = { 'spiritual': t.spiritual, 'deep-work': t.deepWork, 'learning': t.learning, 'office': t.office, 'family': t.family, 'self-care': t.selfCare, 'sleep': t.sleep, 'break': t.break };
            return map[category];
        }
        function getCategoryOptions(selectedCategory) {
            const t = translations[currentLang];
            const categories = { 'spiritual': t.spiritual, 'deep-work': t.deepWork, 'learning': t.learning, 'office': t.office, 'family': t.family, 'self-care': t.selfCare, 'sleep': t.sleep, 'break': t.break };
            return Object.entries(categories).map(([key, value]) => `<option value="${key}" ${key === selectedCategory ? 'selected' : ''}>${value}</option>`).join('');
        }
        function convertTimeToMinutes(timeStr) {
            const [time, modifier] = timeStr.split(' ');
            let [hours, minutes] = time.split(':').map(Number);
            if (modifier === 'PM' && hours !== 12) hours += 12;
            if (modifier === 'AM' && hours === 12) hours = 0;
            return hours * 60 + minutes;
        }
        function addNewActivity() {
            const time = document.getElementById('newTime').value;
            const activity = document.getElementById('newActivity').value;
            const duration = document.getElementById('newDuration').value;
            const category = document.getElementById('newCategory').value;
            if (!time || !activity || !duration) { alert('Please fill all fields!'); return; }
            const newId = scheduleData.length > 0 ? Math.max(...scheduleData.map(item => item.id)) + 1 : 1;
            scheduleData.push({ id: newId, time, activity, duration, category });
            saveUserData(); clearForm(); switchTab('view'); alert('New task added successfully!');
        }
        function startEdit(id) { editMode[id] = true; renderEditableSchedule(); }
        function saveActivity(id) {
            const time = document.getElementById(`edit-time-${id}`).value;
            const activity = document.getElementById(`edit-activity-${id}`).value;
            const duration = document.getElementById(`edit-duration-${id}`).value;
            const category = document.getElementById(`edit-category-${id}`).value;
            if (!time || !activity || !duration) { alert('Please fill all fields!'); return; }
            const index = scheduleData.findIndex(item => item.id === id);
            if (index !== -1) scheduleData[index] = { ...scheduleData[index], time, activity, duration, category };
            editMode[id] = false; saveUserData(); renderEditableSchedule(); alert('Task updated successfully!');
        }
        function cancelEdit(id) { editMode[id] = false; renderEditableSchedule(); }
        function deleteActivity(id) {
            if (confirm('Delete this task?')) {
                scheduleData = scheduleData.filter(item => item.id !== id);
                delete editMode[id]; saveUserData(); renderEditableSchedule(); alert('Task deleted!');
            }
        }
        function clearForm() {
            document.getElementById('newTime').value = '';
            document.getElementById('newActivity').value = '';
            document.getElementById('newDuration').value = '';
            document.getElementById('newCategory').value = 'spiritual';
        }
        function resetToDefault() {
            if (confirm('Reset to default schedule? Current data will be lost.')) {
                scheduleData = [...defaultSchedule]; saveUserData(); switchTab('view'); alert('Reset to default!');
            }
        }
        function clearAllData() {
            if (confirm('Delete all data? This cannot be undone.')) {
                scheduleData = []; editMode = {}; saveUserData(); switchTab('view'); alert('All data deleted!');
            }
        }
        function exportToCSV() {
            let csv = "Time,Activity,Duration,Category\n";
            [...scheduleData].sort((a, b) => convertTimeToMinutes(a.time) - convertTimeToMinutes(b.time)).forEach(item => {
                csv += `"${item.time}","${item.activity}","${item.duration}","${getCategoryText(item.category)}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${currentUser}_schedule.csv`;
            link.click();
        }
        init();
    </script>
</body>
</html>